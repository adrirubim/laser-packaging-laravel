# Internationalization (i18n)

The application supports **three languages**: Italiano (IT), Español (ES), and English (GB). The user’s choice is stored in the session and shared with the frontend via Inertia.

---

## 1. When to use i18n

| Situation | Approach |
|-----------|----------|
| **Single language, no plans for more** | No i18n in frontend; keep backend `lang/` for validation and auth only. |
| **Single language, one place for copy** | Centralize UI strings in a frontend file (e.g. `lib/copy.ts`). |
| **Multiple languages** | Use Laravel as source of truth: session locale, shared via Inertia; `translations` object and `t(key)` in React. |

The current implementation follows the third option.

---

## 2. Current implementation

- **Languages:** IT, ES, EN (GB). Configured in `config/app.php` (`available_locales`).
- **Locale source (priority order):** For authenticated users, `user.preferences['locale']` (persisted in `user_preferences` table); otherwise `session('locale')`. `SetLocale` middleware applies it before each request.
- **Persisted preferences:** Theme, locale, timezone, and date_format are stored in `user_preferences` via Settings → Appearance (authenticated users). Guest users use session for locale.
- **Shared data:** `HandleInertiaRequests` shares `locale` and `translations` (from `lang/{locale}.json`) so every page receives `props.locale` and `props.translations`.
- **Selector (two places only):** **Welcome** — `LocaleDropdown` (round button with SVG flag). **Settings → Appearance** — `LocaleTabs` (three options in a row). The selector is **not** in the main app header.
- **Backend:** `lang/it/`, `lang/es/`, `lang/en/` for auth, validation, pagination, messages. Validation and auth use the active locale automatically.
- **Frontend UI:** `lang/it.json`, `lang/es.json`, `lang/en.json`; keys for `welcome.*`, `auth.*`, `settings.*`, `nav.*` (sidebar), `common.*` (CRUD: save, cancel, search, actions, code, etc.). Components use `useTranslations()` and `t(key)`.

---

## 3. Where the language selector appears

| Place | Component | When |
|-------|-----------|------|
| **Welcome page** | `LocaleDropdown` | Header, left of login/register. Visible to everyone. |
| **Settings → Appearance** | `LocaleTabs` | Inside account management only. |

### 3.1 Language selector: best practice

- **Options (Italiano, Español, English):** Shown in the **native name** of each language (endonym). They are not translated to the current UI language, so users can recognise their language even when the rest of the interface is in another language (W3C, Material Design, Wikipedia, Google).
- **Label of the control** ("Lingua" / "Idioma" / "Language"): Translated via `settings.appearance.language_label` and `t()`, so the section title and `aria-label` match the active language.

---

## 4. Key files

| File | Role |
|------|------|
| `config/app.php` | `locale`, `fallback_locale`, `available_locales` |
| `app/Http/Middleware/SetLocale.php` | Reads session `locale`, sets `App::setLocale()` |
| `bootstrap/app.php` | Registers `SetLocale` in the `web` middleware group |
| `routes/web.php` | `POST /locale` (validate, store in session, redirect back) |
| `app/Http/Middleware/HandleInertiaRequests.php` | Shares `locale` and `translations` (from `lang/{locale}.json`) |
| `lang/{it,es,en}/*.php` | Auth, validation, pagination, messages |
| `lang/{it,es,en}.json` | UI strings (welcome, auth, settings, nav, common) shared as `props.translations` |
| `resources/js/components/locale-dropdown.tsx` | SVG flags, dropdown (welcome) |
| `resources/js/components/locale-tabs.tsx` | Three-option selector (Settings → Appearance) |
| `resources/js/hooks/use-translations.ts` | `useTranslations()` → `t(key)` from `props.translations` |
| `resources/js/types/index.d.ts` | `SharedData.locale`, `SharedData.translations` |

To add a new language: add the code to `available_locales`, create `lang/{code}/` and `lang/{code}.json`, add the option to `LocaleDropdown` and `LocaleTabs`, and extend the `POST /locale` validation rule.

---

## 5. Validation

Run the i18n parity check before committing:

```bash
php scripts/i18n-check.php
```

This ensures all locales (it, es, en) have identical keys and string values. Fails on missing keys or non-string values.

---

## 6. Extending UI translations

- **Add keys** to `lang/it.json`, `lang/es.json`, and `lang/en.json` (flat key-value, dot notation: e.g. `module.screen.label`).
- **Use in React:** `const { t } = useTranslations();` then `t('module.screen.label')` for any user-visible string. Prefer `common.*` for shared CRUD strings (save, cancel, search, actions, code) and page-specific namespaces for the rest.
- **Placeholders:** `t(key, params)` supports `:param` replacement, e.g. `t('dashboard.alert_message_overdue', { count: 5 })` → "There are 5 order(s) with past due delivery date." Use for dynamic values (counts, names) while keeping the sentence in the JSON files.
- **Backend data:** Prefer sending **identifiers** (e.g. `type: 'suspended'`, `status: 2`) from the API; the frontend maps them to translation keys (e.g. `t(\`dashboard.alert_title_${alert.type}\`)`, `t(getOrderStatusLabelKey(order.status))`). This keeps a single source of truth for UI copy and avoids duplicating translations in Laravel.
- **Shared components** that already use `t()`: `ActionsDropdown`, `SearchInput`, `LocaleDropdown`, `LocaleTabs`, sidebar (`app-sidebar.tsx`). When adding new shared UI, use `useTranslations()` and add the keys to the three JSON files.
- **Modules fully internationalized:** Articles (Create, Edit, Show), Offers, common CRUD flows. Avoid hardcoded strings in new features.
